{{>header}}
{{>nav2}}
<div id="layoutSidenav">
    {{>navLatEscritor}}
    <div id="layoutSidenav_content">
        <main>
            <div class="container-fluid px-4">

                {{#mensaje}}
                <div class="alert alert-success alert-dismissible fade show my-3" role="alert">
                    <h2 class="fs-4 text-white text-center">{{mensaje}}</h2>
                    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                </div>
                {{/mensaje}}

                <!-- formulario -->
                <div class="w-50 my-4 mx-auto">

                    <h2 class="mb-4 display-4 text-center">Crear Artículo</h2>

                    <form action="/escritor/crearArticulo" method="post">

                        <div class="mb-3">
                            <label for="tipo-producto" class="form-label" >Diario o revista al que pertenecerá</label>
                            <select
                                    class="form-select"
                                    name="idProducto" required
                                    onchange="mostrarEdiciones(this.value)">
                                <option disabled selected>Seleccione a que diario o revista pertenece</option>
                                {{#productos}}
                                    <option value="{{idProducto}}">{{nombre}}</option>
                                {{/productos}}
                            </select>
                        </div>

                        <div class="mb-3 row">
                            <div class="col-md">
                                <label for="tipo-producto" class="form-label">Edición a la que pertenecerá</label>

                                <select class="form-select"
                                        name="idEdicion" required
                                        id="ajaxEdiciones">
                                    <option disabled selected>Seleccione la edición</option>
                                </select>
                                <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#modalEdicion">
                                    Agregar Edicion
                                </button>
                            </div>
                            <div class="col-md">
                                <label for="" class="form-label">Sección a la que pertenecerá</label>
                                    <select class="form-select"
                                            name="idSeccion" required
                                            id="ajaxSecciones">
                                        <option disabled selected>Seleccione la sección</option>
                                        {{#secciones}}
                                        <option value="{{idSeccion}}">{{nombre}}</option>
                                        {{/secciones}}
                                    </select>
                                <a href="">Agregar Seccion</a>
                            </div>
                        </div>

                        <div class="mb-3">
                            <label for="articulo" class="form-label">Título del artículo</label>
                            <input type="text"
                                   class="form-control"
                                   id="titulo-articulo"
                                   name="titulo-articulo" required>
                        </div>

                        <label for="descripcion-articulo">Descripción del Artículo</label>
                        <textarea
                                class="form-control mb-3"
                                placeholder="Leave a comment here"
                                id="descripcion-articulo"
                                name="descripcion-articulo"
                                style="height: 150px"></textarea>

                        <script>
                            $('#descripcion-articulo').summernote({
                                placeholder: 'Contenido del articulo',
                                tabsize: 2,
                                height: 200
                            });
                        </script>


                        <label for="latitud">Ubicación geográfica del artículo</label>
                        <input class="form-control my-3" type="hidden" id="latitud" name="latitud">
                        <input class="form-control my-3" type="hidden" id="longitud" name="longitud">

                        <div id="map" class="m-auto rounded-3 mb-3" style="width: 100%; height: 300px;"></div>


                        <input type="submit" class="btn btn-outline-dark" value="Crear">
                    </form>
                </div>
                <h4 class="alert text-danger text-center">{{mensaje}}</h4>
                <h4 class="alert text-danger text-center">Los artículos existentes son :
                    {{#listaDeEdiciones}} - {{numero}}  {{/listaDeEdiciones}}</h4>
            </div>
            <!--modal edicion-->
            <div class="modal fade" id="modalEdicion" tabindex="-1" aria-labelledby="modalEdicionLabel" aria-hidden="true">
                <div class="modal-dialog modal-dialog-centered">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h1 class="modal-title fs-5" id="modalEdicion">Modal title</h1>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body">
                            <form action="/escritor/crearEdicionModal" method="post">

                                <div class="mb-3">
                                    <label for="tipo-producto" class="form-label" >Diario o revista al que pertenece</label>
                                    <select class="form-select" name="idProducto" required>
                                        <option disabled selected>Seleccione a que diario o revista pertenece</option>
                                        {{#productos}}
                                            <option value="{{idProducto}}">{{nombre}}</option>
                                        {{/productos}}
                                    </select>
                                </div>

                                <div class="mb-3">
                                    <label for="numero-edicion" class="form-label">Número de la edición</label>
                                    <input type="number" class="form-control" id="numero-edicion" name="numeroEdicion" required>
                                </div>

                                <div class="mb-3">
                                    <label for="precio-edicion" class="form-label" >Precio de la edición</label>
                                    <input type="number" step="0.01" class="form-control" id="precio-edicion" name="precioEdicion" required>
                                </div>

                                <div class="mb-3">
                                    <label for="fecha-edicion" class="form-label" >Fecha de la Edición</label>
                                    <input type="date" class="form-control" id="fecha-edicion" name="fechaEdicion" required>
                                </div>

                                <input type="submit" class="btn btn-outline-dark" value="Crear">
                            </form>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-dialog ">
                ...
            </div>
            <!--modal seccion-->
            <div class="modal-dialog modal-dialog-centered">
                ...
            </div>
            <!--JQuery-->
            <script type="text/javascript" src="/public/jQuery/jquery.js"></script>
            <!--AJAX y custom-->
            <script type="text/javascript">
                function mostrarEdiciones(producto) {
                    console.log(producto);

                    var parametros = {
                        "producto" : producto
                    };

                    $.ajax({
                        data:  parametros,
                        url:   '/escritor/getEdiciones',
                        type:  'post',
                        beforeSend: function () {
                            $("#ajaxEdiciones").html("Procesando, espere por favor...");
                            console.log("en el beforeSend");
                        },
                        success:  function (response) {
                            console.log(response);
                            $("#ajaxEdiciones").html(response);
                        }
                    });
                }

                function initMap(){
                    var coordenadas = {
                        lat: -34.67312,
                        lng: -58.48061
                    };
                    var map = new google.maps.Map(document.getElementById('map'),{
                        zoom: 15,
                        center: coordenadas
                    });
                    var marker = new google.maps.Marker({
                        map: map,
                        position: coordenadas,
                        draggable: true
                    });

                    /* Esto salta como deprecado, pero no pude hacerlo andar con addEventListener
                    *  (no estoy seguro si es por un problema de la api key)
                    *  */
                    google.maps.event.addListener(marker,'dragend',function() {
                        document.querySelector('#latitud').value = marker.getPosition().lat();
                        document.querySelector('#longitud').value = marker.getPosition().lng();
                    });
                }
            </script>
            <!--API Maps-->
            <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBDaeWicvigtP9xPv919E-RNoxfvC-Hqik&callback=initMap"></script>
{{>footer}}

